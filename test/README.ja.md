# Go-Gate ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ãƒ†ã‚¹ãƒˆ

*ä»–ã®è¨€èªžã§èª­ã‚€: [English](README.md), [í•œêµ­ì–´](README.ko.md)*

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€Go-Gate L7ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã®ãŸã‚ã®ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

Go-Gateã¯**Docker**ï¼ˆæŽ¨å¥¨ï¼‰ã¾ãŸã¯**ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º**ã§ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚

### ðŸ³ æ–¹æ³•1: Dockerãƒ†ã‚¹ãƒˆï¼ˆæŽ¨å¥¨ï¼‰

**å‰ææ¡ä»¶:** Docker DesktopãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã€å®Ÿè¡Œä¸­

```bash
# ã™ã¹ã¦ã‚’é–‹å§‹ï¼ˆ1ã‚³ãƒžãƒ³ãƒ‰ï¼‰
./docker/start.sh

# ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
./docker/test.sh

# ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’åœæ­¢
./docker/stop.sh
```

**å‹•ä½œå†…å®¹ï¼š**
- âœ… Go-Gateãƒ—ãƒ­ã‚­ã‚·ã‚’è‡ªå‹•ãƒ“ãƒ«ãƒ‰
- âœ… ã‚³ãƒ³ãƒ†ãƒŠã§ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼3å°ã‚’é–‹å§‹
- âœ… ã‚³ãƒ³ãƒ†ãƒŠé–“ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’è¨­å®š
- âœ… ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
- âœ… ãƒ­ãƒ¼ã‚«ãƒ«ä¾å­˜é–¢ä¿‚ä¸è¦

### ðŸ’» æ–¹æ³•2: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ

**å‰ææ¡ä»¶:** Go 1.24.6+, Python 3.7+

#### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ¢ãƒƒã‚¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```bash
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1: ãƒ¢ãƒƒã‚¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
cd test/
python3 mock-servers.py
```

3ã¤ã®ãƒ¢ãƒƒã‚¯HTTPã‚µãƒ¼ãƒãƒ¼ã‚’é–‹å§‹ï¼š
- `localhost:3001` - APIã‚µãƒ¼ãƒãƒ¼1ï¼ˆé‡ã¿: 2ï¼‰
- `localhost:3002` - APIã‚µãƒ¼ãƒãƒ¼2ï¼ˆé‡ã¿: 1ï¼‰  
- `localhost:4000` - Webã‚µãƒ¼ãƒãƒ¼ï¼ˆé‡ã¿: 1ï¼‰

#### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```bash
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2: ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚’èµ·å‹•
go build -o go-gate cmd/server/main.go
./go-gate -config configs/test-config.yaml
```

ãƒ—ãƒ­ã‚­ã‚·ã¯`localhost:8080`ã§é–‹å§‹ã—ã€ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã—ã¾ã™ã€‚

#### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«3: è‡ªå‹•ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
cd test/
./test-requests.sh
```

### ðŸ”„ ä¸¡æ–¹æ³•ã§åŒã˜ãƒ†ã‚¹ãƒˆã‚’ä½¿ç”¨

`test-requests.sh`ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯Dockerã¨ãƒ­ãƒ¼ã‚«ãƒ«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®ä¸¡æ–¹ã§å‹•ä½œã—ã¾ã™!

## ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

### `mock-servers.py`
ãƒ†ã‚¹ãƒˆç”¨ã®3ã¤ã®HTTPã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆã™ã‚‹Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼š
- ã‚µãƒ¼ãƒãƒ¼æƒ…å ±ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆè©³ç´°ã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å«ã‚€JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™
- GETã¨POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä¸¡æ–¹ã‚’å‡¦ç†
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ç”¨ã® `/health` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å«ã‚€
- ã™ã¹ã¦ã®å—ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ­ã‚°ã«è¨˜éŒ²

### `test-requests.sh`
æ§˜ã€…ãªãƒ—ãƒ­ã‚­ã‚·ã‚·ãƒŠãƒªã‚ªã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼š
- ãƒ‘ã‚¹ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° (`/api/*`)
- ãƒ›ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° (`admin.example.com`, `*.example.com`)
- ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã®æ¤œè¨¼
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç†
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### `test-config.yaml`
ãƒ†ã‚¹ãƒˆç”¨ã®ç°¡ç•¥åŒ–ã•ã‚ŒãŸè¨­å®šï¼ˆãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯è¨­å®šãªã—ï¼‰ã€‚

## æ‰‹å‹•ãƒ†ã‚¹ãƒˆ

### åŸºæœ¬ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆï¼ˆå…¨ã‚µãƒ¼ãƒãƒ¼ã§ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ï¼‰
curl http://localhost:8080/

# APIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆï¼ˆAPIã‚µãƒ¼ãƒãƒ¼é–“ã§ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ï¼‰
curl http://localhost:8080/api/users

# POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ†ã‚¹ãƒˆ
curl -X POST -H "Content-Type: application/json" \
     -d '{"test": "data"}' \
     http://localhost:8080/api/submit
```

### ãƒ›ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

ã¾ãšã€`/etc/hosts` ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ†ã‚¹ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ï¼š
```bash
# /etc/hosts ã«ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ 
127.0.0.1 admin.example.com
127.0.0.1 www.example.com
```

ãã®å¾Œãƒ†ã‚¹ãƒˆï¼š
```bash
# APIã‚µãƒ¼ãƒãƒ¼1ã®ã¿ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã‚‹ã¯ãš
curl -H "Host: admin.example.com" http://localhost:8080/dashboard

# Webã‚µãƒ¼ãƒãƒ¼ã®ã¿ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã‚‹ã¯ãš
curl -H "Host: www.example.com" http://localhost:8080/home
```

## æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ

### ãƒ‘ã‚¹ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- `/api/*` ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€APIã‚µãƒ¼ãƒãƒ¼1ï¼ˆé‡ã¿2ï¼‰ã¨APIã‚µãƒ¼ãƒãƒ¼2ï¼ˆé‡ã¿1ï¼‰é–“ã§ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã•ã‚Œã‚‹
- APIã‚µãƒ¼ãƒãƒ¼1ãŒç´„67%ã€APIã‚µãƒ¼ãƒãƒ¼2ãŒç´„33%ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã™ã‚‹ã¯ãš

### ãƒ›ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- `admin.example.com` ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ APIã‚µãƒ¼ãƒãƒ¼1 ã®ã¿ã«é€ã‚‰ã‚Œã‚‹
- `*.example.com` ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆ`www.example.com`ãªã©ï¼‰ã¯ Webã‚µãƒ¼ãƒãƒ¼ ã®ã¿ã«é€ã‚‰ã‚Œã‚‹

### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- ãã®ä»–ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯3ã¤ã®ã‚µãƒ¼ãƒãƒ¼ã™ã¹ã¦ã§ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã•ã‚Œã‚‹
- åˆ†æ•£: APIã‚µãƒ¼ãƒãƒ¼1ï¼ˆ50%ï¼‰ã€APIã‚µãƒ¼ãƒãƒ¼2ï¼ˆ25%ï¼‰ã€Webã‚µãƒ¼ãƒãƒ¼ï¼ˆ25%ï¼‰

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ—ãƒ­ã‚­ã‚·ãŒèµ·å‹•ã—ãªã„
- ãƒãƒ¼ãƒˆ8080ãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª: `lsof -i :8080`
- è¨­å®šæ§‹æ–‡ã‚’æ¤œè¨¼: `./go-gate -config configs/test-config.yaml`

### ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ãªã„
- ãƒãƒ¼ãƒˆ3001, 3002, 4000ãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª
- Python 3ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª: `python3 --version`

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹
- ã™ã¹ã¦ã®ã‚µãƒ¼ãƒãƒ¼ãŒå®Ÿè¡Œä¸­ã‹ç¢ºèª: `ps aux | grep -E "(go-gate|python)"`
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¤ã„ã¦ãƒ—ãƒ­ã‚­ã‚·ãƒ­ã‚°ã‚’ç¢ºèª
- ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ã‚’ç›´æŽ¥ãƒ†ã‚¹ãƒˆ: `curl http://localhost:3001/`

### ãƒ›ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒå‹•ä½œã—ãªã„
- `/etc/hosts` ã‚¨ãƒ³ãƒˆãƒªãŒæ­£ã—ãè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- ãƒ†ã‚¹ãƒˆã«ã¯ `curl -H "Host: domain.com"` ã‚’ä½¿ç”¨
- DNSè§£æ±ºã‚’ç¢ºèª: `nslookup admin.example.com`

## é«˜åº¦ãªãƒ†ã‚¹ãƒˆ

### è² è·ãƒ†ã‚¹ãƒˆ
```bash
# è² è·åˆ†æ•£ãƒ†ã‚¹ãƒˆï¼ˆ'ab' - Apache Bench ãŒå¿…è¦ï¼‰
ab -n 100 -c 10 http://localhost:8080/api/test

# ã¾ãŸã¯ãƒ«ãƒ¼ãƒ—ã§curlã‚’ä½¿ç”¨
for i in {1..20}; do
  curl -s http://localhost:8080/api/test | grep '"server"'
done | sort | uniq -c
```

### ã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ª
```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã‚’1ã¤åœæ­¢ã—ã¦ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ
# APIã‚µãƒ¼ãƒãƒ¼2ã‚’åœæ­¢ï¼ˆmock-servers.pyã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§Ctrl+Cã€ãã®å¾Œãƒãƒ¼ãƒˆ3002ãªã—ã§å†èµ·å‹•ï¼‰
curl http://localhost:8080/api/test  # APIã‚µãƒ¼ãƒãƒ¼1ã§å‹•ä½œã—ç¶šã‘ã‚‹ã¯ãš

# ã™ã¹ã¦ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒåœæ­¢ã—ãŸçŠ¶æ…‹ã§ãƒ†ã‚¹ãƒˆ
# mock-servers.py ã‚’å®Œå…¨ã«åœæ­¢
curl http://localhost:8080/  # 502 Bad Gateway ã‚’è¿”ã™ã¯ãš
```

## ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°
ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ã‚­ã‚·ãƒ­ã‚°ã®ç›£è¦–ï¼š
```bash
./go-gate -config configs/test-config.yaml | grep -E "(api_server|web_server)"
```

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ†æ•£åˆ†æž
```bash
# ã©ã®ã‚µãƒ¼ãƒãƒ¼ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã—ã¦ã„ã‚‹ã‹ã‚’åˆ†æž
./test-requests.sh 2>&1 | grep "Server=" | sort | uniq -c
```