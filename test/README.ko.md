# Go-Gate ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ í…ŒìŠ¤íŠ¸

*ë‹¤ë¥¸ ì–¸ì–´ë¡œ ì½ê¸°: [English](README.md), [æ—¥æœ¬èªž](README.ja.md)*

ì´ ë””ë ‰í† ë¦¬ëŠ” Go-Gate L7 ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„œë²„ë¥¼ ìœ„í•œ í…ŒìŠ¤íŠ¸ ë„êµ¬ì™€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

## ë¹ ë¥¸ ì‹œìž‘

Go-GateëŠ” **Docker** (ê¶Œìž¥) ë˜ëŠ” **ë¡œì»¬ ê°œë°œ**ì„ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

### ðŸ³ ë°©ë²• 1: Docker í…ŒìŠ¤íŠ¸ (ê¶Œìž¥)

**ì‚¬ì „ ìš”êµ¬ ì‚¬í•­:** Docker Desktop ì„¤ì¹˜ ë° ì‹¤í–‰

```bash
# ëª¨ë“  ê²ƒ ì‹œìž‘ (1ê°œ ëª…ë ¹)
./docker/start.sh

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
./docker/test.sh

# ëª¨ë“  ì„œë¹„ìŠ¤ ì¤‘ì§€
./docker/stop.sh
```

**ìˆ˜í–‰ ìž‘ì—…:**
- âœ… Go-Gate í”„ë¡ì‹œë¥¼ ìžë™ìœ¼ë¡œ ë¹Œë“œ
- âœ… ì»¨í…Œì´ë„ˆì—ì„œ 3ê°œ ëª© ì„œë²„ ì‹œìž‘
- âœ… ì»¨í…Œì´ë„ˆ ê°„ ë„¤íŠ¸ì›Œí‚¹ ì„¤ì •
- âœ… í—¬ìŠ¤ ì²´í¬ ì‹¤í–‰
- âœ… ë¡œì»¬ ì¢…ì†ì„± ë¶ˆí•„ìš”

### ðŸ’» ë°©ë²• 2: ë¡œì»¬ í…ŒìŠ¤íŠ¸

**ì‚¬ì „ ìš”êµ¬ ì‚¬í•­:** Go 1.24.6+, Python 3.7+

#### 1ë‹¨ê³„: ëª© ë°±ì—”ë“œ ì„œë²„ ì‹œìž‘

```bash
# í„°ë¯¸ë„ 1: ëª© ë°±ì—”ë“œ ì„œë²„ ì‹œìž‘
cd test/
python3 mock-servers.py
```

ì„¸ ê°œì˜ ëª© HTTP ì„œë²„ë¥¼ ì‹œìž‘í•©ë‹ˆë‹¤:
- `localhost:3001` - API ì„œë²„ 1 (ê°€ì¤‘ì¹˜: 2)
- `localhost:3002` - API ì„œë²„ 2 (ê°€ì¤‘ì¹˜: 1)  
- `localhost:4000` - ì›¹ ì„œë²„ (ê°€ì¤‘ì¹˜: 1)

#### 2ë‹¨ê³„: í”„ë¡ì‹œ ì„œë²„ ì‹œìž‘

```bash
# í„°ë¯¸ë„ 2: ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì‹œìž‘
go build -o go-gate cmd/server/main.go
./go-gate -config configs/test-config.yaml
```

í”„ë¡ì‹œëŠ” `localhost:8080`ì—ì„œ ì‹œìž‘ë˜ê³  ëª© ì„œë²„ë¡œ ìš”ì²­ì„ ë¼ìš°íŒ…í•©ë‹ˆë‹¤.

#### 3ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# í„°ë¯¸ë„ 3: ìžë™í™”ëœ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
cd test/
./test-requests.sh
```

### ðŸ”„ ë‘ ë°©ë²• ëª¨ë‘ ë™ì¼í•œ í…ŒìŠ¤íŠ¸ ì‚¬ìš©

`test-requests.sh` ìŠ¤í¬ë¦½íŠ¸ëŠ” Dockerì™€ ë¡œì»¬ ì„¤ì • ëª¨ë‘ì—ì„œ ìž‘ë™í•©ë‹ˆë‹¤!

## í…ŒìŠ¤íŠ¸ íŒŒì¼

### `mock-servers.py`
í…ŒìŠ¤íŠ¸ìš© ì„¸ ê°œì˜ HTTP ì„œë²„ë¥¼ ìƒì„±í•˜ëŠ” Python ìŠ¤í¬ë¦½íŠ¸:
- ì„œë²„ ì •ë³´, ìš”ì²­ ì„¸ë¶€ì‚¬í•­, íƒ€ìž„ìŠ¤íƒ¬í”„ê°€ í¬í•¨ëœ JSON ì‘ë‹µ ë°˜í™˜
- GET ë° POST ìš”ì²­ ëª¨ë‘ ì²˜ë¦¬
- í—¬ìŠ¤ ì²´í¬ìš© `/health` ì—”ë“œí¬ì¸íŠ¸ í¬í•¨
- ëª¨ë“  ìˆ˜ì‹  ìš”ì²­ ë¡œê¹…

### `test-requests.sh`
ë‹¤ì–‘í•œ í”„ë¡ì‹œ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ì…¸ ìŠ¤í¬ë¦½íŠ¸:
- ê²½ë¡œ ê¸°ë°˜ ë¼ìš°íŒ… (`/api/*`)
- í˜¸ìŠ¤íŠ¸ ê¸°ë°˜ ë¼ìš°íŒ… (`admin.example.com`, `*.example.com`)
- ë¡œë“œ ë°¸ëŸ°ì‹± ê²€ì¦
- ê¸°ë³¸ ë¼ìš°íŒ… í´ë°±
- POST ìš”ì²­ ì²˜ë¦¬
- í—¬ìŠ¤ ì²´í¬ ì—”ë“œí¬ì¸íŠ¸

### `test-config.yaml`
í…ŒìŠ¤íŠ¸ìš© ê°„ì†Œí™”ëœ êµ¬ì„± (í—¬ìŠ¤ ì²´í¬ ì„¤ì • ì œì™¸).

## ìˆ˜ë™ í…ŒìŠ¤íŠ¸

### ê¸°ë³¸ ìš”ì²­

```bash
# ê¸°ë³¸ ë¼ìš°íŒ… í…ŒìŠ¤íŠ¸ (ëª¨ë“  ì„œë²„ì— ë¡œë“œ ë°¸ëŸ°ì‹±)
curl http://localhost:8080/

# API ë¼ìš°íŒ… í…ŒìŠ¤íŠ¸ (API ì„œë²„ë“¤ ê°„ ë¡œë“œ ë°¸ëŸ°ì‹±)
curl http://localhost:8080/api/users

# POST ìš”ì²­ í…ŒìŠ¤íŠ¸
curl -X POST -H "Content-Type: application/json" \
     -d '{"test": "data"}' \
     http://localhost:8080/api/submit
```

### í˜¸ìŠ¤íŠ¸ ê¸°ë°˜ ë¼ìš°íŒ…

ë¨¼ì €, `/etc/hosts` íŒŒì¼ì— í…ŒìŠ¤íŠ¸ ë„ë©”ì¸ì„ ì¶”ê°€í•©ë‹ˆë‹¤:
```bash
# /etc/hostsì— ë‹¤ìŒ ì¤„ë“¤ì„ ì¶”ê°€
127.0.0.1 admin.example.com
127.0.0.1 www.example.com
```

ê·¸ëŸ° ë‹¤ìŒ í…ŒìŠ¤íŠ¸:
```bash
# API ì„œë²„ 1ë¡œë§Œ ë¼ìš°íŒ…ë˜ì–´ì•¼ í•¨
curl -H "Host: admin.example.com" http://localhost:8080/dashboard

# ì›¹ ì„œë²„ë¡œë§Œ ë¼ìš°íŒ…ë˜ì–´ì•¼ í•¨
curl -H "Host: www.example.com" http://localhost:8080/home
```

## ì˜ˆìƒ ë™ìž‘

### ê²½ë¡œ ê¸°ë°˜ ë¼ìš°íŒ…
- `/api/*`ë¡œì˜ ìš”ì²­ì€ API ì„œë²„ 1 (ê°€ì¤‘ì¹˜ 2)ê³¼ API ì„œë²„ 2 (ê°€ì¤‘ì¹˜ 1) ê°„ì— ë¡œë“œ ë°¸ëŸ°ì‹±ë¨
- API ì„œë²„ 1ì´ ì•½ 67%ì˜ ìš”ì²­ì„, API ì„œë²„ 2ê°€ ì•½ 33%ì˜ ìš”ì²­ì„ ë°›ì•„ì•¼ í•¨

### í˜¸ìŠ¤íŠ¸ ê¸°ë°˜ ë¼ìš°íŒ…
- `admin.example.com` ìš”ì²­ì€ API ì„œë²„ 1ë¡œë§Œ ì´ë™
- `*.example.com` ìš”ì²­ (`www.example.com`ê³¼ ê°™ì€)ì€ ì›¹ ì„œë²„ë¡œë§Œ ì´ë™

### ê¸°ë³¸ ë¼ìš°íŒ…
- ë‹¤ë¥¸ ëª¨ë“  ìš”ì²­ì€ ì„¸ ì„œë²„ ëª¨ë‘ì— ë¡œë“œ ë°¸ëŸ°ì‹±ë¨
- ë¶„ì‚°: API ì„œë²„ 1 (50%), API ì„œë²„ 2 (25%), ì›¹ ì„œë²„ (25%)

## ë¬¸ì œ í•´ê²°

### í”„ë¡ì‹œê°€ ì‹œìž‘ë˜ì§€ ì•ŠìŒ
- í¬íŠ¸ 8080ì´ ì‚¬ìš© ê°€ëŠ¥í•œì§€ í™•ì¸: `lsof -i :8080`
- êµ¬ì„± ë¬¸ë²• ê²€ì¦: `./go-gate -config configs/test-config.yaml`

### ëª© ì„œë²„ê°€ ì‹œìž‘ë˜ì§€ ì•ŠìŒ
- í¬íŠ¸ 3001, 3002, 4000ì´ ì‚¬ìš© ê°€ëŠ¥í•œì§€ í™•ì¸
- Python 3ì´ ì„¤ì¹˜ë˜ì–´ ìžˆëŠ”ì§€ í™•ì¸: `python3 --version`

### ìš”ì²­ ì‹¤íŒ¨
- ëª¨ë“  ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸: `ps aux | grep -E "(go-gate|python)"`
- ì˜¤ë¥˜ ë©”ì‹œì§€ì— ëŒ€í•œ í”„ë¡ì‹œ ë¡œê·¸ í™•ì¸
- ëª© ì„œë²„ë¥¼ ì§ì ‘ í…ŒìŠ¤íŠ¸: `curl http://localhost:3001/`

### í˜¸ìŠ¤íŠ¸ ê¸°ë°˜ ë¼ìš°íŒ…ì´ ìž‘ë™í•˜ì§€ ì•ŠìŒ
- `/etc/hosts` í•­ëª©ì´ ì˜¬ë°”ë¥´ê²Œ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸
- í…ŒìŠ¤íŠ¸ì— `curl -H "Host: domain.com"` ì‚¬ìš©
- DNS í•´ì„ í™•ì¸: `nslookup admin.example.com`

## ê³ ê¸‰ í…ŒìŠ¤íŠ¸

### ë¡œë“œ í…ŒìŠ¤íŠ¸
```bash
# ë¡œë“œ ë¶„ì‚° í…ŒìŠ¤íŠ¸ ('ab' - Apache Bench í•„ìš”)
ab -n 100 -c 10 http://localhost:8080/api/test

# ë˜ëŠ” ë°˜ë³µë¬¸ì—ì„œ curl ì‚¬ìš©
for i in {1..20}; do
  curl -s http://localhost:8080/api/test | grep '"server"'
done | sort | uniq -c
```

### ì˜¤ë¥˜ ì‹œë‚˜ë¦¬ì˜¤
```bash
# í•˜ë‚˜ì˜ ë°±ì—”ë“œ ì„œë²„ë¥¼ ì¤‘ì§€í•˜ê³  íŽ˜ì¼ì˜¤ë²„ í…ŒìŠ¤íŠ¸
# API ì„œë²„ 2 ì¤‘ì§€ (mock-servers.py í„°ë¯¸ë„ì—ì„œ Ctrl+C, ê·¸ë‹¤ìŒ í¬íŠ¸ 3002 ì—†ì´ ìž¬ì‹œìž‘)
curl http://localhost:8080/api/test  # API ì„œë²„ 1ë¡œ ê³„ì† ìž‘ë™í•´ì•¼ í•¨

# ëª¨ë“  ë°±ì—”ë“œê°€ ë‹¤ìš´ëœ ìƒíƒœë¡œ í…ŒìŠ¤íŠ¸
# mock-servers.pyë¥¼ ì™„ì „ížˆ ì¤‘ì§€
curl http://localhost:8080/  # 502 Bad Gatewayë¥¼ ë°˜í™˜í•´ì•¼ í•¨
```

## ëª¨ë‹ˆí„°ë§

### ì‹¤ì‹œê°„ ë¡œê·¸
ìš”ì²­ ë¼ìš°íŒ…ì„ ë³´ê¸° ìœ„í•´ í”„ë¡ì‹œ ë¡œê·¸ í™•ì¸:
```bash
./go-gate -config configs/test-config.yaml | grep -E "(api_server|web_server)"
```

### ìš”ì²­ ë¶„ì‚° ë¶„ì„
```bash
# ì–´ë–¤ ì„œë²„ê°€ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ìžˆëŠ”ì§€ ë¶„ì„
./test-requests.sh 2>&1 | grep "Server=" | sort | uniq -c
```