# Go-Gate L7 리버스 프록시

*다른 언어로 읽기: [English](README.md), [日本語](README.ja.md)*

Go로 구축된 경량 Layer 7 리버스 프록시 서버로, 호스트 기반 및 경로 기반 라우팅과 로드 밸런싱을 지원합니다.

## 기능

- **L7 라우팅**: 호스트, 경로 또는 둘 다를 기준으로 요청 라우팅
- **로드 밸런싱**: 여러 업스트림에 걸친 가중 라운드 로빈 로드 밸런싱
- **헬스 체크**: 기본 헬스 체크 구성 (구현을 위한 구조 준비)
- **요청 로깅**: 응답 시간과 상태를 포함한 HTTP 접근 로그
- **유연한 구성**: 검증 기능이 포함된 YAML 기반 구성

## 프로젝트 구조

```
go-gate/
├── cmd/server/main.go          # 애플리케이션 진입점
├── internal/
│   ├── config/config.go        # 구성 관리
│   ├── proxy/server.go         # 메인 프록시 서버 로직
│   ├── router/router.go        # 요청 라우팅 및 업스트림 선택
│   └── middleware/logging.go   # HTTP 미들웨어 (로깅)
├── configs/config.yaml         # 예제 구성
└── docs/README.md             # 이 문서
```

## 시작하기

Go-Gate는 두 가지 방법으로 실행할 수 있습니다: **Docker** (권장) 또는 **로컬 개발**.

### 🐳 옵션 1: Docker (권장)

**사전 요구 사항:**
- Docker Desktop 설치 및 실행

**빠른 시작:**
```bash
# 모든 것 시작 (프록시 + 목 서버)
./docker/start.sh

# 테스트 실행
./docker/test.sh

# 서비스 중지
./docker/stop.sh
```

**장점:** ✅ 설치할 종속성 없음 ✅ 일관된 환경 ✅ 원클릭 설정  
**단점:** ❌ Docker 필요 ❌ 느린 시작

자세한 지침은 [Docker 설정 가이드](DOCKER.ko.md)를 참조하세요.

### 💻 옵션 2: 로컬 개발

**사전 요구 사항:**
- Go 1.24.6 이상
- Python 3.7+ (목 서버용)
- 리버스 프록시와 HTTP에 대한 기본 이해

**빠른 시작:**

```bash
# 터미널 1: 목 백엔드 서버 시작
cd test/
python3 mock-servers.py

# 터미널 2: 프록시 서버 시작
go build -o go-gate cmd/server/main.go
./go-gate -config configs/test-config.yaml

# 터미널 3: 테스트 실행
cd test/
./test-requests.sh
```

**장점:** ✅ 빠른 시작 ✅ 직접 디버깅 ✅ Docker 불필요  
**단점:** ❌ Go/Python 설치 필요 ❌ 수동 설정 ❌ 환경 차이

### 🔄 방법 간 전환

두 접근 방식은 독립적으로 작동합니다:
- **Docker 파일은 로컬 개발에 영향을 주지 않음**
- **로컬 설정은 Docker와 간섭하지 않음**
- **동일한 테스트 스크립트가 두 방법 모두에서 작동**

## 📊 Docker vs 로컬 비교

| 기능 | 🐳 Docker | 💻 로컬 |
|---------|-----------|----------|
| **설정 시간** | ~2-3분 | ~1분 |
| **종속성** | Docker Desktop만 | Go 1.24.6+, Python 3.7+ |
| **환경** | 시스템 간 일관성 | 로컬 설정에 의존 |
| **디버깅** | 컨테이너 로그 | 직접 IDE 디버깅 |
| **리소스 사용** | 높음 (컨테이너) | 낮음 (네이티브 프로세스) |
| **격리** | 완전 격리 | 시스템 리소스 사용 |
| **CI/CD 준비** | ✅ 완벽 | ❌ 설정 필요 |
| **초보자 친화적** | ✅ 원클릭 | ❌ 여러 단계 |
| **개발 속도** | 느린 빌드 | 빠른 반복 |

### 💡 언제 각각을 사용할지

**Docker 사용 시:**
- 🚀 빠르게 시작하기
- 🔄 CI/CD 파이프라인에서 테스트
- 👥 팀 일관성 보장
- 🐛 시스템 종속성으로부터 격리
- 📦 프로덕션 환경 시뮬레이션

**로컬 사용 시:**
- ⚡ 빠른 개발 반복
- 🐞 IDE 브레이크포인트로 디버깅
- 🔧 구성을 자주 사용자 정의
- 💾 시스템 리소스 절약
- 📚 Go 개발 패턴 학습

### 구성

서버는 YAML 구성 파일을 사용합니다. 예제는 `configs/config.yaml`을 참조하세요.

#### 구성 구조:

- **server**: 서버 설정 (포트)
- **upstreams**: 가중치 및 헬스 체크 설정을 포함한 백엔드 서버 정의
- **routes**: 호스트/경로 매칭을 포함한 라우팅 규칙

#### 라우트 매칭:

- **호스트 매칭**: 정확한 매치와 와일드카드 (`*.example.com`) 지원
- **경로 매칭**: 정확한 매치와 접두사 매칭 (`/api/*`) 지원
- **로드 밸런싱**: 여러 업스트림 간 가중 분산

### 사용 예제

제공된 구성으로 프록시는 다음과 같이 동작합니다:

1. `/api/*` 요청을 API 서버(api_server_1, api_server_2)로 라우팅
2. `admin.example.com` 요청을 api_server_1로 라우팅
3. `*.example.com` 요청을 web_server로 라우팅
4. 기타 요청은 모든 서버로 폴백

### 개발 명령어

- **빌드**: `go build cmd/server/main.go`
- **실행**: `go run cmd/server/main.go`
- **테스트**: `go test ./...`
- **포맷**: `go fmt ./...`
- **검사**: `go vet ./...`
- **모듈 정리**: `go mod tidy`

## Docker 배포

Go-Gate는 쉬운 배포와 테스트를 위한 완전한 Docker 지원을 포함합니다:

- **완전한 환경**: 프록시 + 목 백엔드 서버
- **원클릭 설정**: `./docker/start.sh`
- **자동화된 테스트**: `./docker/test.sh`
- **프로덕션 준비**: 최적화된 Dockerfile과 docker-compose

완전한 설정 지침은 [Docker 문서](DOCKER.ko.md)를 참조하세요.

### 향후 개선 사항

1. **헬스 체킹**: 실제 헬스 체크 모니터링 구현
2. **메트릭**: 모니터링을 위한 Prometheus 메트릭 추가
3. **TLS 지원**: HTTPS/TLS 종료 추가
4. **요청 제한**: 요청 속도 제한 구현
5. **서킷 브레이커**: 업스트림 장애를 위한 서킷 브레이커 패턴 추가
6. **WebSocket 지원**: WebSocket 프록시 기능 추가