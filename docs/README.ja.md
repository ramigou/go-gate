# Go-Gate L7 リバースプロキシ

Goで構築された軽量なLayer 7リバースプロキシサーバーで、ホストベースおよびパスベースのルーティングとロードバランシングをサポートします。

## 機能

- **L7ルーティング**: ホスト、パス、またはその両方に基づいてリクエストをルーティング
- **ロードバランシング**: 複数のアップストリーム間での重み付きラウンドロビンロードバランシング
- **ヘルスチェック**: 基本的なヘルスチェック設定（実装のための構造準備済み）
- **リクエストロギング**: レスポンス時間とステータスを含むHTTPアクセスログ
- **柔軟な設定**: バリデーション機能付きのYAMLベース設定

## プロジェクト構造

```
go-gate/
├── cmd/server/main.go          # アプリケーションエントリーポイント
├── internal/
│   ├── config/config.go        # 設定管理
│   ├── proxy/server.go         # メインプロキシサーバーロジック
│   ├── router/router.go        # リクエストルーティングとアップストリーム選択
│   └── middleware/logging.go   # HTTPミドルウェア（ロギング）
├── configs/config.yaml         # 設定例
└── docs/README.md             # このドキュメント
```

## 始め方

### 前提条件

- Go 1.24.6以上
- リバースプロキシとHTTPの基本的な理解

### サーバーの実行

1. **アプリケーションのビルド:**
   ```bash
   go build -o go-gate cmd/server/main.go
   ```

2. **デフォルト設定で実行:**
   ```bash
   ./go-gate
   ```

3. **カスタム設定で実行:**
   ```bash
   ./go-gate -config /path/to/your/config.yaml
   ```

### 設定

サーバーはYAML設定ファイルを使用します。例については`configs/config.yaml`を参照してください。

#### 設定構造:

- **server**: サーバー設定（ポート）
- **upstreams**: 重みとヘルスチェック設定を持つバックエンドサーバー定義
- **routes**: ホスト/パスマッチングを含むルーティングルール

#### ルートマッチング:

- **ホストマッチング**: 完全一致とワイルドカード（`*.example.com`）をサポート
- **パスマッチング**: 完全一致とプレフィックスマッチング（`/api/*`）をサポート
- **ロードバランシング**: 複数のアップストリーム間での重み付き分散

### 使用例

提供された設定により、プロキシは以下のように動作します：

1. `/api/*`リクエストをAPIサーバー（api_server_1, api_server_2）にルーティング
2. `admin.example.com`リクエストをapi_server_1にルーティング
3. `*.example.com`リクエストをweb_serverにルーティング
4. その他のリクエストは全サーバーにフォールバック

### 開発コマンド

- **ビルド**: `go build cmd/server/main.go`
- **実行**: `go run cmd/server/main.go`
- **テスト**: `go test ./...`
- **フォーマット**: `go fmt ./...`
- **検査**: `go vet ./...`
- **モジュール整理**: `go mod tidy`

### 今後の拡張項目

1. **ヘルスチェック**: 実際のヘルスチェックモニタリングの実装
2. **メトリクス**: モニタリングのためのPrometheusメトリクスの追加
3. **TLSサポート**: HTTPS/TLS終端の追加
4. **レート制限**: リクエストレート制限の実装
5. **サーキットブレーカー**: アップストリーム障害のためのサーキットブレーカーパターンの追加
6. **WebSocketサポート**: WebSocketプロキシ機能の追加