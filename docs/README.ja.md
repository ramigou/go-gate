# Go-Gate L7 リバースプロキシ

*他の言語で読む: [English](README.md), [한국어](README.ko.md)*

Goで構築された軽量なLayer 7リバースプロキシサーバーで、ホストベースおよびパスベースのルーティングとロードバランシングをサポートします。

## 機能

- **L7ルーティング**: ホスト、パス、またはその両方に基づいてリクエストをルーティング
- **ロードバランシング**: 複数のアップストリーム間での重み付きラウンドロビンロードバランシング
- **ヘルスチェック**: 基本的なヘルスチェック設定（実装のための構造準備済み）
- **リクエストロギング**: レスポンス時間とステータスを含むHTTPアクセスログ
- **柔軟な設定**: バリデーション機能付きのYAMLベース設定

## プロジェクト構造

```
go-gate/
├── cmd/server/main.go          # アプリケーションエントリーポイント
├── internal/
│   ├── config/config.go        # 設定管理
│   ├── proxy/server.go         # メインプロキシサーバーロジック
│   ├── router/router.go        # リクエストルーティングとアップストリーム選択
│   └── middleware/logging.go   # HTTPミドルウェア（ロギング）
├── configs/config.yaml         # 設定例
└── docs/README.md             # このドキュメント
```

## 始め方

Go-Gateは2つの方法で実行できます：**Docker**（推奨）または**ローカル開発**。

### 🐳 オプション1: Docker（推奨）

**前提条件：**
- Docker Desktopがインストールされ、実行中

**クイックスタート：**
```bash
# すべてを開始（プロキシ + モックサーバー）
./docker/start.sh

# テストを実行
./docker/test.sh

# サービスを停止
./docker/stop.sh
```

**長所:** ✅ インストールする依存関係なし ✅ 一貫した環境 ✅ ワンコマンドセットアップ  
**短所:** ❌ Dockerが必要 ❌ 起動が遅い

詳細な手順については[Dockerセットアップガイド](DOCKER.ja.md)を参照してください。

### 💻 オプション2: ローカル開発

**前提条件：**
- Go 1.24.6以上
- Python 3.7+（モックサーバー用）
- リバースプロキシとHTTPの基本的な理解

**クイックスタート：**

```bash
# ターミナル1: モックバックエンドサーバーを開始
cd test/
python3 mock-servers.py

# ターミナル2: プロキシサーバーを開始
go build -o go-gate cmd/server/main.go
./go-gate -config configs/test-config.yaml

# ターミナル3: テストを実行
cd test/
./test-requests.sh
```

**長所:** ✅ 高速起動 ✅ 直接デバッグ ✅ Docker不要  
**短所:** ❌ Go/Pythonのインストールが必要 ❌ 手動セットアップ ❌ 環境の違い

### 🔄 方法の切り替え

両方のアプローチは独立して動作します：
- **Dockerファイルはローカル開発に影響しない**
- **ローカルセットアップはDockerと干渉しない**
- **同じテストスクリプトが両方の方法で動作**

## 📊 Docker vs ローカル比較

| 機能 | 🐳 Docker | 💻 ローカル |
|---------|-----------|----------|
| **セットアップ時間** | ~2-3分 | ~1分 |
| **依存関係** | Docker Desktopのみ | Go 1.24.6+, Python 3.7+ |
| **環境** | システム間で一貫 | ローカル設定に依存 |
| **デバッグ** | コンテナログ | 直接IDEデバッグ |
| **リソース使用量** | 高（コンテナ） | 低（ネイティブプロセス） |
| **分離** | 完全な分離 | システムリソース使用 |
| **CI/CD対応** | ✅ 完璧 | ❌ セットアップが必要 |
| **初心者フレンドリー** | ✅ ワンコマンド | ❌ 複数ステップ |
| **開発速度** | 遅いビルド | 高速なイテレーション |

### 💡 どちらを使うべきか

**Dockerを使う場合：**
- 🚀 素早く始める
- 🔄 CI/CDパイプラインでのテスト
- 👥 チームの一貫性を保証
- 🐛 システム依存関係からの分離
- 📦 本番環境のシミュレーション

**ローカルを使う場合：**
- ⚡ 高速な開発イテレーション
- 🐞 IDEブレークポイントでのデバッグ
- 🔧 設定を頻繁にカスタマイズ
- 💾 システムリソースの節約
- 📚 Go開発パターンの学習

### 設定

サーバーはYAML設定ファイルを使用します。例については`configs/config.yaml`を参照してください。

#### 設定構造:

- **server**: サーバー設定（ポート）
- **upstreams**: 重みとヘルスチェック設定を持つバックエンドサーバー定義
- **routes**: ホスト/パスマッチングを含むルーティングルール

#### ルートマッチング:

- **ホストマッチング**: 完全一致とワイルドカード（`*.example.com`）をサポート
- **パスマッチング**: 完全一致とプレフィックスマッチング（`/api/*`）をサポート
- **ロードバランシング**: 複数のアップストリーム間での重み付き分散

### 使用例

提供された設定により、プロキシは以下のように動作します：

1. `/api/*`リクエストをAPIサーバー（api_server_1, api_server_2）にルーティング
2. `admin.example.com`リクエストをapi_server_1にルーティング
3. `*.example.com`リクエストをweb_serverにルーティング
4. その他のリクエストは全サーバーにフォールバック

### 開発コマンド

- **ビルド**: `go build cmd/server/main.go`
- **実行**: `go run cmd/server/main.go`
- **テスト**: `go test ./...`
- **フォーマット**: `go fmt ./...`
- **検査**: `go vet ./...`
- **モジュール整理**: `go mod tidy`

## Dockerデプロイメント

Go-Gateは簡単なデプロイメントとテストのための完全なDockerサポートを含んでいます：

- **完全な環境**: プロキシ + モックバックエンドサーバー
- **ワンコマンドセットアップ**: `./docker/start.sh`
- **自動テスト**: `./docker/test.sh`
- **プロダクション対応**: 最適化されたDockerfileとdocker-compose

完全なセットアップ手順については[Dockerドキュメント](DOCKER.ja.md)を参照してください。

### 今後の拡張項目

1. **ヘルスチェック**: 実際のヘルスチェックモニタリングの実装
2. **メトリクス**: モニタリングのためのPrometheusメトリクスの追加
3. **TLSサポート**: HTTPS/TLS終端の追加
4. **レート制限**: リクエストレート制限の実装
5. **サーキットブレーカー**: アップストリーム障害のためのサーキットブレーカーパターンの追加
6. **WebSocketサポート**: WebSocketプロキシ機能の追加